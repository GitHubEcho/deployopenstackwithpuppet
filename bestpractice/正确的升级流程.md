# 升级到Puppet4

Puppet4的第一个正式版本于2015年4月15日发布，它与3.x版本在许多方面都有区别。我们来看看显著的几点变化。

## 包管理方式的变化

过去，我们需要在服务器上单独安装Puppet,Facter,Hiera,Mcollective等多个组件才能获得相应的功能和特性。在Puppet4中，Puppet4软件包不再使用`puppet`，而是重新命名为`puppet-agent`，并采用All-in-One的方式来简化软件包的管理，其中包含以下组件：
 - Facter 3.4.x
 - CFacter 0.4
 - Hiera 1.3.x
 - Mcollective 2.9.x
 - Ruby 2.1.5
 - OpenSSL 1.0.0r

**注意**  `puppet-agent`不会自动升级老版本的`puppet`软件包(建议使用deb或rpm来管理软件包的升级)

## 配置文件/目录的路径变化

 1. 软件包的安装目录变更为`/opt/puppetlabs`
 3. 可执行文件已移动到`/opt/puppetlabs/bin`
 4. `confdir`从`/etc/puppet/`变为`/etc/puppetlabs/puppet`
 5. `ssldir`从`$vardir/ssl`变为`$confdir/ssl`
 6. puppetserver的配置文件放置在`/etc/puppetlabs/puppetserver`
 7. mcollective的配置文件放置在`/etc/puppetlabs/mcollective`
 8. 所有的module/manifest/data从`confdir`移到`codedir`
   - `codedir`默认路径是`/etc/puppetlabs/code`
   - 包含`environments`目录
   - 包含全局的`modules`目录（可选）
   - 包含hiera.yaml配置文件
   - 包含`hieradata`目录
 
## `Directory Environment`被正式启用

默认的environmentpath是`$codedir/environments`。

以新建一个`production`环境为例：
   - 将modules放置到`$codedir/environments/production/modules`
   - 将main manifest放置到`$codedir/environments/production/manifests`

你仍然可以使用`$codedir/modules`作为全局modules，并用`default_manifest`设置来配置一个全局的`main manifest`。

# 其他变化

 - `puppet agent`的`vardir`已经移动到`/opt/puppetlabs/puppet/cache`
 - `rundir`已经移动到`/var/run/puppetlabs`



